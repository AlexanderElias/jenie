/*
			name: jenie
		version: 1.4.1
		license: mpl-2.0
		author: alexander elias

		This Source Code Form is subject to the terms of the Mozilla Public
		License, v. 2.0. If a copy of the MPL was not distributed with this
		file, You can obtain one at http://mozilla.org/MPL/2.0/.
	*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('Jenie',b):a.Jenie=b()})(this,function(){'use strict';function a(u){var v=this;v.data=u.data,v.view=u.view,v.model=u.model,v.events=u.events,v.element=u.element,v.attribute=u.attribute,v.modifiers=u.modifiers,v.renderMethod=(v.renderMethods[v.attribute.cmds[0]]||v.renderMethods['default']).bind(v),v.unrenderMethod=(v.unrenderMethods[v.attribute.cmds[0]]||v.unrenderMethods['default']).bind(v),Object.defineProperty(v,'data',{enumerable:!0,configurable:!0,get:function(){var w=p.getByPath(v.model.data,v.attribute.path);return v.modifiers.forEach(function(z){w=z.call(w)}),w},set:function(w){return v.modifiers.forEach(function(z){w=z.call(w)}),p.setByPath(v.model.data,v.attribute.path,w)}}),v.renderMethod()}function b(){}function c(u){Object.defineProperty(this,'data',{value:u||[]})}function d(){this.data=new c}function g(u,v){var w=this;w.view=new d,w.model=new b,w.events=u.events||{},w._model=u.model||{},w._view=(u.view.shadowRoot||u.view).querySelectorAll('*'),w.name=u.name,w.modifiers=u.modifiers||{},w.model.listener(function(z,A){A===void 0?w.view.unrenderAll('^'+z+'.*'):w.view.renderAll('^'+z)}),w.view.listener(function(z,A){w.view.data.get(A.path).push(new a({view:w.view,model:w.model,events:w.events,element:z,attribute:A,modifiers:A.modifiers.map(function(B){return w.modifiers[B]})}))}),'function'==typeof u.model?w._model.call(w,function(z){if(w._model=z,w.model.run(w._model),w.view.run(w._view),v)return v.call(w)}):(w.model.run(w._model),w.view.run(w._view),v&&v.call(w))}function h(u){var v=this;if(u=u||{},!u.name)throw new Error('Component missing options.name');if(!u.template)throw new Error('Component missing options.template');v.name=u.name,v.model=u.model,v.style=u.style,v.events=u.events,v.modifiers=u.modifiers,v.currentScript=document._currentScript||document.currentScript,v.template=v.toTemplate(u.template),v.proto=Object.create(HTMLElement.prototype),v.proto.attachedCallback=u.attached,v.proto.detachedCallback=u.detached,v.proto.attributeChangedCallback=u.attributed,v.proto.createdCallback=function(){v.element=this,v.element.uuid=s(),v.slotify(),v.element.appendChild(document.importNode(v.template.content,!0)),v.model?v.element.controller=new g({model:v.model,view:v.element,events:v.events,name:v.element.uuid,modifiers:v.modifiers},function(){v.element.view=this.view.data,v.element.model=this.model.data,u.created&&u.created.call(v.element)}):u.created&&u.created.call(v.element)},v.define()}function j(){this.events={}}function k(u){u=u||{},j.call(this),this.state={},this.cache={},this.origin=window.location.origin,this.external=u.external,this.routes=u.routes||[],this.view=u.view||'j-view',this.hash=!!u.hash&&u.hash,this.contain=!!u.contain&&u.contain,this.base=u.base||'',Object.defineProperty(this,'root',{enumerable:!0,get:function(){return this.hash?'/#/':'/'}}),document.registerElement('j-view',{prototype:Object.create(HTMLElement.prototype)})}function m(){this.modules={}}function n(){}var p={setByPath:function(u,v,w){for(var C,z=v.split('.'),A=z.length-1,B=0;B<A;B++)C=z[B],void 0===u[C]&&(u[C]={}),u=u[C];return u[z[A]]=w},getByPath:function(u,v){for(var w=v.split('.'),z=w.length-1,A=0;A<z;A++){if(!u[w[A]])return;u=u[w[A]]}return u[w[z]]},toCamelCase:function(u){return'Array'===u.constructor.name&&(u=u.join('-')),u.replace(/-[a-z]/g,function(v){return v[1].toUpperCase()})}};a.prototype.renderMethods={on:function(){var u=this;u.eventName||(u.eventName=u.attribute.cmds[1],u.eventMethod=p.getByPath(u.events,u.attribute.path).bind(u.model.data)),u.element.removeEventListener(u.eventName,u.eventMethod),u.element.addEventListener(u.eventName,u.eventMethod)},each:function(){var u=this;if(u.data=u.data||[],u.clone||(u.variable=u.attribute.cmds.slice(1).join('.'),u.clone=u.element.removeChild(u.element.children[0]).outerHTML,u.pattern=new RegExp('(((data-)?j(-(\\w)+)+="))'+u.variable+'(((\\.(\\w)+)+)?((\\s+)?\\|((\\s+)?(\\w)+)+)?(\\s+)?")','g')),u.element.children.length>u.data.length)for(;u.element.children.length>u.data.length;)u.view.removeAll(u.element.children[u.element.children.length-1].querySelectorAll('*')),u.view.removeOne(u.element.children[u.element.children.length-1]),u.element.removeChild(u.element.children[u.element.children.length-1]);else if(u.element.children.length<u.data.length)for(;u.element.children.length<u.data.length;)u.element.insertAdjacentHTML('beforeend',u.clone.replace(u.pattern,'$1'+u.attribute.path+'.'+u.element.children.length+'$6')),u.view.addAll(u.element.children[u.element.children.length-1].querySelectorAll('*')),u.view.addOne(u.element.children[u.element.children.length-1])},value:function(){var u=this;return u.change?void 0:'button'===u.element.type||'reset'===u.element.type?u.change=!0:void(u.change=function(){u.data='radio'!==u.element.type&&'checked'!==u.element.type?u.element.value:u.element.checked},u.element.addEventListener('change',u.change.bind(u),!0),u.element.addEventListener('keyup',u.change.bind(u),!0))},html:function(){this.element.innerHTML=this.data,this.view.addAll(this.element.querySelectorAll('*'))},css:function(){var u=this.data;1<this.attribute.cmds.length&&(u=this.attribute.cmds.slice(1).join('-')+': '+u+';'),this.element.style.cssText+=u},class:function(){var u=this.attribute.cmds.slice(1).join('-');this.element.classList.toggle(u,this.data)},text:function(){this.element.innerText=this.data},enable:function(){this.element.disabled=!this.data},disable:function(){this.element.disabled=this.data},show:function(){this.element.hidden=!this.data},hide:function(){this.element.hidden=this.data},write:function(){this.element.readOnly=!this.data},read:function(){this.element.readOnly=this.data},selected:function(){this.element.selectedIndex=this.data},default:function(){var u=p.toCamelCase(this.attribute.cmds);p.setByPath(this.element,u,this.data)}},a.prototype.unrenderMethods={on:function(){var u=this.attribute.cmds[1];this.element.removeEventListener(u,this.data,!1)},each:function(){for(;this.element.lastChild;)this.element.removeChild(this.element.lastChild)},value:function(){this.element.removeEventListener('change',this.change.bind(this)),this.element.removeEventListener('keyup',this.change.bind(this))},html:function(){this.element.innerText=''},text:function(){this.element.innerText=''},default:function(){}},a.prototype.unrender=function(){return this.unrenderMethod(),this},a.prototype.render=function(){return this.renderMethod(),this},b.prototype.join=function(){return Array.prototype.join.call(arguments,'.').replace(/\.{2,}/g,'.').replace(/^\.|\.$/g,'')},b.prototype.isCollection=function(u){return u&&('Object'===u.constructor.name||'Array'===u.constructor.name)},b.prototype.defineSplice=function(u,v,w,z){var A=this;z[2]?(Array.prototype.splice.call(v,z[0],z[1]),A.emit(A.join(u),w)):Array.prototype.slice.call(z,2).forEach(function(B){B=A.defineCollection(u,B),Array.prototype.splice.call(v,z[0],z[1],B),w=A.defineProperty(u,v,w,v.length-1),A.emit(A.join(u),w)})},b.prototype.arrayPushUnshift=function(u,v,w,z,A){var B=this;Array.prototype.forEach.call(A,function(C){C=B.defineCollection(u,C),Array.prototype[z].call(v,C),w=B.defineProperty(u,v,w,v.length-1),B.emit(B.join(u),w)})},b.prototype.arrayPopShift=function(u,v,w,z){var A=this;Array.prototype[z].call(v),Array.prototype.pop.call(w),A.emit(A.join(u),w)},b.prototype.defineArray=function(u,v,w){var z=this;return Object.defineProperties(w,{splice:{value:function(){return z.defineSplice(u,v,w,arguments)}},push:{value:function(){return z.arrayPushUnshift(u,v,w,'push',arguments)}},unshift:{value:function(){return z.arrayPushUnshift(u,v,w,'unshift',arguments)}},pop:{value:function(){return z.arrayPopShift(u,v,w,'pop')}},shift:{value:function(){return z.arrayPopShift(u,v,w,'shift')}}})},b.prototype.defineObject=function(u,v,w){var z=this;return Object.defineProperties(w,{$set:{value:function(A,B){z.isCollection(B)&&(B=z.defineCollection(z.join(u,A),B)),v[A]=B,w=z.defineProperty(u,v,w,A),z.emit(z.join(u,A),w[A])}},$remove:{value:function(A){delete w[A],delete v[A],z.emit(z.join(u,A),void 0)}}})},b.prototype.defineProperty=function(u,v,w,z){var A=this;return Object.defineProperty(w,z,{enumerable:!0,configurable:!0,get:function(){return v[z]},set:function(B){v[z]!==B&&(B===void 0?(delete v[z],delete w[z],A.emit(A.join(u,z),void 0)):(v[z]=A.defineCollection(A.join(u,z),B),A.emit(A.join(u,z),w[z])))}})},b.prototype.defineCollection=function(u,v){var w=this;if(!w.isCollection(v))return v;var z=v?v.constructor.name:'',A=v.constructor(),B=v.constructor();return'Object'===z?A=w.defineObject(u,B,A):'Array'===z&&(A=w.defineArray(u,B,A)),Object.keys(v).forEach(function(C){void 0!==v[C]&&(B[C]=w.defineCollection(w.join(u,C),v[C]),A=w.defineProperty(u,B,A,C))}),A},b.prototype.listener=function(u){this.emit=u},b.prototype.run=function(u){this.data=this.defineCollection('',u)},c.prototype.get=function(u){for(var v=0;v<this.data.length;v++)if(u===this.data[v][0])return this.data[v][1]},c.prototype.remove=function(u){for(var v=0;v<this.data.length;v++)if(u===this.data[v][0])return this.data.splice(v,1)[0][1]},c.prototype.removeById=function(u){return this.data.splice(u,1)},c.prototype.has=function(u){for(var v=0;v<this.data.length;v++)if(u===this.data[v][0])return!0;return!1},c.prototype.set=function(u,v){for(var w=0;w<this.data.length;w++)if(u===this.data[w][0])return this.data[w][1]=v;return this.data[this.data.length]=[u,v]},c.prototype.push=function(u){return this.data[this.data.length]=[this.data.length,u],u},c.prototype.size=function(){return this.data.length},c.prototype.forEach=function(u,v){v=v||null;for(var w=0;w<this.data.length;w++)u.call(v,this.data[w][1],this.data[w][0],w,this.data)},d.prototype.regexp={PATH:/\s?\|(.*?)$/,PREFIX:/(data-)?j-/,MODIFIERS:/^(.*?)\|\s?/,ATTRIBUTE_ACCEPTS:/(data-)?j-/,ELEMENT_ACCEPTS:/(data-)?j-/,ELEMENT_REJECTS_CHILDREN:/(data-)?j-each/,ELEMENT_REJECTS:/^\w+(-\w+)+|^iframe|^object|^script|^style|^svg/},d.prototype.preview=function(u){return u.outerHTML.replace(/\/?>([\s\S])*/,'').replace(/^</,'')},d.prototype.eachElement=function(u,v){for(var w=0,z=u.length;w<z;w++){var A=u[w],B=this.preview(A);this.regexp.ELEMENT_REJECTS.test(B)?w+=A.querySelectorAll('*').length:this.regexp.ELEMENT_REJECTS_CHILDREN.test(B)?(w+=A.querySelectorAll('*').length,v.call(this,A)):this.regexp.ELEMENT_ACCEPTS.test(B)&&v.call(this,A)}},d.prototype.eachAttribute=function(u,v){Array.prototype.forEach.call(u.attributes,function(w){if(this.regexp.ATTRIBUTE_ACCEPTS.test(w.name)){var z={};z.name=w.name,z.value=w.value,z.path=z.value.replace(this.regexp.PATH,''),z.opts=z.path.split('.'),z.command=z.name.replace(this.regexp.PREFIX,''),z.cmds=z.command.split('-'),z.key=z.opts.slice(-1),z.modifiers=-1===z.value.indexOf('|')?[]:z.value.replace(this.regexp.MODIFIERS,'').split(' '),v.call(this,z)}},this)},d.prototype.unrenderAll=function(u){u='string'==typeof u?new RegExp(u):u,this.data.forEach(function(v,w){v.forEach(function(z){u.test(w)&&z.unrender()},this)},this)},d.prototype.renderAll=function(u){u='string'==typeof u?new RegExp(u):u,this.data.forEach(function(v,w){v.forEach(function(z){u.test(w)&&z.render()},this)},this)},d.prototype.removeOne=function(u){this.data.forEach(function(v,w,z){v.forEach(function(A,B,C){u===A.element&&(v.removeById(C),0===v.size()&&this.data.removeById(z))},this)},this)},d.prototype.removeAll=function(u){Array.prototype.forEach.call(u,function(v){this.removeOne(v)},this)},d.prototype.addOne=function(u){this.eachAttribute(u,function(v){this.data.has(v.path)||this.data.set(v.path,new c),this.emit(u,v)})},d.prototype.addAll=function(u){this.eachElement(u,function(v){this.addOne(v)})},d.prototype.listener=function(u){this.emit=u},d.prototype.run=function(u){this.elements=u,this.addAll(this.elements)};var q='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),s=function(u){var w,v=[];if(u)for(w=0;w<u;w++)v[w]=q[0|Math.random()*u];else{var z;for(v[8]='-',v[13]='-',v[14]='4',v[18]='-',v[23]='-',w=0;36>w;w++)v[w]||(z=0|16*Math.random(),v[w]=q[19==w?8|3&z:z])}return v.join('')};h.prototype.slotify=function(){for(var u=this,v=u.element.querySelectorAll('[slot]'),w=0,z=v.length;w<z;w++){var A=v[w],B=A.getAttribute('slot'),C=u.template.content.querySelector('slot[name='+B+']');C.parentNode.replaceChild(A,C)}},h.prototype.toDom=function(u){var v=document.createElement('template');return v.innerHTML=u,v},h.prototype.toTemplate=function(u){return'String'===u.constructor.name&&(/<|>/.test(u)?u=this.toDom(u):u=this.currentScript.ownerDocument.querySelector(u)),u},h.prototype.define=function(){document.registerElement(this.name,{prototype:this.proto})},j.prototype.on=function(u,v){'object'!=typeof this.events[u]&&(this.events[u]=[]),this.events[u].push(v)},j.prototype.off=function(u,v){if('object'==typeof this.events[u]){var w=this.events[u].indexOf(v);-1<w&&this.events[u].splice(w,1)}},j.prototype.once=function(u,v){this.on(u,function w(){this.off(u,w),v.apply(this,arguments)})},j.prototype.emit=function(u){if('object'==typeof this.events[u])for(var v=this.events[u].slice(),w=[].slice.call(arguments,1),z=0,A=v.length;z<A;z++)v[z].apply(this,w)},k.prototype=Object.create(j.prototype),k.prototype.constructor=k,k.prototype._popstate=function(u){this.navigate(u.state||window.location.href,!0)},k.prototype._click=function(u){var v=this;if(!(u.metaKey||u.ctrlKey||u.shiftKey)){for(var w=u.path?u.path[0]:u.target;w&&'A'!==w.nodeName;)w=w.parentNode;!w||'A'!==w.nodeName||v.external&&('Function'===v.external.constructor.name&&v.external(w.href)||'RegExp'===v.external.constructor.name&&v.external.test(w.href)||'String'===v.external.constructor.name&&new RegExp(v.external).test(w.href))||w.hasAttribute('download')||w.hasAttribute('external')||-1!==w.href.indexOf('mailto:')||-1!==w.href.indexOf('file:')||-1!==w.href.indexOf('tel:')||-1!==w.href.indexOf('ftp:')||(u.preventDefault(),v.navigate(w.href))}},k.prototype._load=function(u){if(this.view='string'==typeof this.view?document.querySelector(this.view):this.view,(this.contain?this.view:window).addEventListener('click',this._click.bind(this)),window.addEventListener('popstate',this._popstate.bind(this)),window.removeEventListener('DOMContentLoaded',this._load),this.navigate(window.location.href,!0),u)return u()},k.prototype.listen=function(u,v){if(u)for(var w in u)this[w]=u[w];'complete'===document.readyState||'loaded'===document.readyState?this._load(v):window.addEventListener('DOMContentLoaded',this._load.bind(this,v),!0)},k.prototype.normalize=function(u){return u=decodeURI(u).replace(/\/{2,}/g,'/').replace(/(http(s)?:\/)/,'$1/').replace(/\?.*?/,''),this.hash||(u=u.replace(/#.*?$/,'')),u=''===u?'/':u},k.prototype.parse=function(u){return new RegExp('^'+u.replace(/{\*}/g,'(?:.*)').replace(/{(\w+)}/g,'([^/]+)')+'(/)?$')},k.prototype.parameters=function(u,v){for(var w,G,z={},A=/{|}/g,B=/{(\w+)}/,C=v.split('/'),D=u.split('/'),E=0,F=D.length;E<F;E++)G=D[E],B.test(G)&&(w=G.replace(A,''),z[w]=C[E]);return z},k.prototype.join=function(){return this.normalize(Array.prototype.join.call(arguments,'/'))},k.prototype.scroll=function(u,v){window.scroll(u,v)},k.prototype.url=function(u){var v={};return v.path=u,v.base=this.base,v.root=this.root,v.origin=this.origin,0===v.path.indexOf(v.origin)&&(v.path=v.path.replace(v.origin,'')),0===v.path.indexOf(v.base)&&(v.path=v.path.replace(v.base,'')),0===v.path.indexOf(window.location.origin)&&(v.path=v.path.replace(window.location.origin,'')),0===v.path.indexOf(v.root)&&(v.path=v.path.replace(v.root,'/')),'/'!==v.path[0]&&(v.path=this.join(window.location.pathname.replace(this.base,''),v.path)),v.path=this.join(v.path,'/'),v.href=this.join(v.origin,v.base,v.root,v.path),v},k.prototype.appendComponentElement=function(u,v){var w;if(/\.html$/.test(u))w=document.createElement('link'),w.setAttribute('href',u),w.setAttribute('rel','import');else if(/\.js$/.test(u))w=document.createElement('script'),w.setAttribute('src',u),w.setAttribute('type','text/javascript');else throw new Error('Invalid extension type');w.onload=v,w.setAttribute('async',''),document.head.appendChild(w)},k.prototype.render=function(u,v){var w=this;u.title&&(document.title=u.title);var z=function(){if(w.view.firstChild&&w.view.removeChild(w.view.firstChild),w.cache[u.component]||(w.cache[u.component]=document.createElement(u.component)),w.view.appendChild(w.cache[u.component]),v)return v()};u.componentUrl&&!w.cache[u.component]?w.appendComponentElement(u.componentUrl,z):z()},k.prototype.redirect=function(u,v){return window.location.href=u,v()},k.prototype.add=function(u){'Object'===u.constructor.name?this.routes.push(u):'Array'===u.constructor.name&&(this.routes=this.routes.concat(u))},k.prototype.remove=function(u){for(var v=0,w=this.routes.length;v<w;v++)if(u===this.routes[v].path)return this.routes.splice(v,1)},k.prototype.get=function(u){for(var z,v=0,w=this.routes.length;v<w;v++)if(z=this.routes[v],!z.path)continue;else if('String'===z.path.constructor.name){if(this.parse(z.path).test(u))return z.parameters=this.parameters(z.path,u),z;}else if('RegExp'===z.path.constructor.name){if(z.path.test(u))return z;}else if('Function'===z.path.constructor.name&&z.path(u))return z},k.prototype.navigate=function(u,v){var w=this;'string'==typeof u?(w.state.url=w.url(u),w.state.route=w.get(w.state.url.path)||{},w.state.parameters=w.state.route.parameters||{},w.state.title=w.state.route.title||''):w.state=u,window.history[v?'replaceState':'pushState'](w.state,w.state.route.title,w.state.url.href),w.state.route.redirect?w.redirect(w.state.route,function(){v||w.scroll(0,0),w.emit('navigated')}):w.render(w.state.route,function(){v||w.scroll(0,0),w.emit('navigated')})},m.prototype.load=function(u){u.forEach(function(v){var w=document.createElement('script');w.src=v,w.async=!1,w.type='text/javascript',document.head.appendChild(w)})},m.prototype.import=function(u){if(u in this.modules)return'function'==typeof this.modules[u]?this.modules[u]():this.modules[u];throw new Error('module '+u+' is not defined')},m.prototype.export=function(u,v,w){if(u in this.modules)throw new Error('module '+u+' is defined');else return'function'==typeof v&&(w=v,v=[]),'function'==typeof w&&v.forEach(function(z){w=w.bind(null,this.import(z))},this),this.modules[u]=w},n.prototype.mime={html:'text/html',text:'text/plain',xml:'application/xml, text/xml',json:'application/json, text/javascript',urlencoded:'application/x-www-form-urlencoded',script:'text/javascript, application/javascript, application/x-javascript'},n.prototype.serialize=function(u){var v='';for(var w in u)v=0<v.length?v+'&':v,v=v+encodeURIComponent(w)+'='+encodeURIComponent(u[w]);return v},n.prototype.fetch=function(u){var v=this;if(u=u?u:{},u.action=u.action?u.action:window.location.href,u.method=u.method?u.method.toUpperCase():'GET',u.headers=u.headers?u.headers:{},u.data)if('GET'===u.method)u.action=u.action+'?'+v.serialize(u.data),u.data=null;else{switch(u.requestType=u.requestType?u.requestType.toLowerCase():'',u.responseType=u.responseType?u.responseType.toLowerCase():'',u.requestType){case'script':u.contentType=v.mime.script;break;case'json':u.contentType=v.self.mime.json;break;case'xml':u.contentType=v.mime.xm;break;case'html':u.contentType=v.mime.html;break;case'text':u.contentType=v.mime.text;break;default:u.contentType=v.mime.urlencoded;}switch(u.responseType){case'script':u.accept=v.mime.script;break;case'json':u.accept=v.mime.json;break;case'xml':u.accept=v.mime.xml;break;case'html':u.accept=v.mime.html;break;case'text':u.accept=v.mime.text;}u.contentType===v.mime.json&&(u.data=JSON.stringify(u.data)),u.contentType===v.mime.urlencoded&&(u.data=v.serialize(u.data))}var w=new XMLHttpRequest;if(w.open(u.method,u.action,!0,u.username,u.password),u.mimeType&&w.overrideMimeType(u.mimeType),u.withCredentials&&(w.withCredentials=u.withCredentials),u.accept&&(u.headers.Accept=u.accept),u.contentType&&(u.headers['Content-Type']=u.contentType),u.headers)for(var z in u.headers)w.setRequestHeader(z,u.headers[z]);w.onreadystatechange=function(){if(4===w.readyState)return 200<=w.status&&400>w.status?u.success(w):u.error(w)},w.send(u.data)};var t=new function(){var v=document.createElement('style'),w=document.createTextNode('j-view, j-view > :first-child { display: block; }');v.appendChild(w),document.head.appendChild(v),this.services={},this.http=new n,this.module=new m,this.router=new k,this.setup=function(z,A){var B=this;z.module&&z.module.forEach(function(C){B.module.export.apply(B,C)}),B.router.listen(z.router,function(){if(A)return A()})},this.component=function(z){return new h(z)},this.controller=function(z,A){return new g(z,A)},this.script=function(){return document._currentScript||document.currentScript},this.document=function(){return(document._currentScript||document.currentScript).ownerDocument},this.element=function(z){return(document._currentScript||document.currentScript).ownerDocument.createElement(z)},this.query=function(z){return(document._currentScript||document.currentScript).ownerDocument.querySelector(z)}};return t});